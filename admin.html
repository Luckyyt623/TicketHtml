<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel</title>
    <style>
        body { background: #121212; color: #fff; font-family: Arial, sans-serif; padding: 20px; }
        h2 { color: #ffd700; }
        .ticket { background: #1f1f1f; border: 2px solid #ffd700; border-radius: 10px; padding: 10px; margin-bottom: 20px; }
        .ticket h3 { margin-top: 0; }
        .messages { background: #2a2a2a; border-radius: 8px; padding: 10px; max-height: 200px; overflow-y: auto; }
        .input { display: flex; margin-top: 10px; }
        .input input { flex: 1; padding: 8px; background: #333; border: 1px solid #ffd700; color: #fff; border-radius: 6px; }
        .input button { background: linear-gradient(45deg, #ffd700, #ffcc00); border: none; color: #1a1a1a; border-radius: 6px; padding: 8px 12px; margin-left: 10px; }
    </style>
</head>
<body>
    <h2>Admin Panel</h2>
    <div id="login">
        <input type="password" id="admin-password" placeholder="Enter Admin Password">
        <button onclick="adminLogin()">Login</button>
    </div>
    <div id="tickets"></div>

    <script>
        const ws = new WebSocket('wss://YOUR-RENDER-WS-URL'); // Replace with your deployed WS URL
        let isAdmin = false;

        function adminLogin() {
            const password = document.getElementById('admin-password').value;
            ws.send(JSON.stringify({ type: 'admin-login', password }));
        }

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.type === 'admin-login' && data.success) {
                isAdmin = true;
                document.getElementById('login').style.display = 'none';
                ws.send(JSON.stringify({ type: 'get-tickets' }));
            } else if (data.type === 'all-tickets') {
                const container = document.getElementById('tickets');
                container.innerHTML = '';
                data.tickets.forEach(ticket => {
                    const ticketDiv = document.createElement('div');
                    ticketDiv.className = 'ticket';
                    ticketDiv.innerHTML = `<h3>${ticket.ticketId} (${ticket.username})</h3>`;
                    const messagesDiv = document.createElement('div');
                    messagesDiv.className = 'messages';
                    ticket.messages.forEach(msg => {
                        messagesDiv.innerHTML += `<p><strong>${msg.sender}:</strong> ${msg.text} <em>${msg.timestamp}</em></p>`;
                    });
                    ticketDiv.appendChild(messagesDiv);

                    const inputDiv = document.createElement('div');
                    inputDiv.className = 'input';
                    inputDiv.innerHTML = `
                        <input type="text" id="reply-${ticket.ticketId}" placeholder="Type a reply...">
                        <button onclick="sendReply('${ticket.ticketId}')">Reply</button>
                    `;
                    ticketDiv.appendChild(inputDiv);

                    container.appendChild(ticketDiv);
                });
            }
        };

        function sendReply(ticketId) {
            const input = document.getElementById(`reply-${ticketId}`);
            const text = input.value.trim();
            if (text !== '') {
                ws.send(JSON.stringify({ type: 'admin-reply', ticketId, text }));
                input.value = '';
            }
        }
    </script>
</body>
</html>